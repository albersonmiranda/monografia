---
title: "Relações Escolaridade-Renda no ES"
author: Alberson Miranda
date: '`r format(Sys.Date(), "%B de %Y")`'
navigation: horizontal
format:
    beamer:
        theme: "Madrid"
        include-in-header: config/preamble_apresentacao.tex
        output-file: render/apresentacao.pdf
        toc: true
        toc-title: SUMÁRIO
execute:
    echo: false
cite-method: biblatex
---

```{r config}
#| include = FALSE

# opções
knitr::opts_chunk$set(
    out.width = "100%",
    echo = FALSE
)

# reprodutibilidade
set.seed(1)

# pacotes
pacman::p_load(
    kableExtra,
    ggplot2
)

# dados
rais = readRDS("data/rais.RDS")

# tema ggplot
tema = theme_classic() +
    theme(
        text = element_text(family = "serif")
    )

# gerar bibliografia de pacotes
knitr::write_bib(file = "config/packages.bib")
```

### OBJETIVO

Estimar as relações escolaridade-renda no mercado de trabalho formal do Espírito Santo, destacando o impacto de pertencer a substratos marginalizados da sociedade na determinação da renda do trabalhador

# PROCEDIMENTOS METODOLÓGICOS

## DADOS

- Relação Anual das Informações Sociais (Rais)
- Trabalhador formal
- 2020
- 768 030 observações
- Base dos Dados \cite{basedosdados}

## DADOS

Variáveis de interesse

1. renda média nominal naquele ano
2. ciclo de escolaridade
3. idade
4. raça/cor
5. sexo

## VIÉS DE VARIÁVEL OMITIDA

::: {.incremental}

- Omissão da ocupação, indústria, renda dos pais, escolaridade dos pais etc

"the whole point of getting an education is to help people move to better industries, not to move from assistant burger-flipper to chief burger-flipper \cite{cochrane}"

- duas propostas (robustez):
    - modelo apenas com variáveis de interesse
    - modelo com ocupação e região

:::

## DADOS

- Possíveis valores para as variáveis selecionadas da Rais
```{r possiveis valores rais}

kbl(
    data.frame(
        Variável = c(
            "Sigla UF",
            "Renda Média Nominal",
            "Ciclo de Escolaridade",
            "Idade",
            "Raça/Cor",
            "Sexo",
            "Ocupação",
            "Região"
        ),
        Valores = c(
            "ES",
            "Núméricos, não negativos",
            "Analfabeto, Ensino Fundamental (I/II, completo/incompleto),  Ensino Médio (completo/incompleto), Ensino Superior (completo/incompleto), Mestrado ou Doutorado",
            "$>25$",
            "Branco, Preto, Pardo, Indígena ou Amarelo",
            "Masculino ou Feminino",
            "46 ocupações do segundo nível de agregação da Classificação Brasileira de Ocupações (CBO)",
            "Grande Vitória (Vitória, Vila Velha, Cariacica e Serra) ou Interior"
        )
    ),
    booktabs = TRUE,
    escape = FALSE) |>
kable_styling(latex_options = "striped", font_size = 8) |>
column_spec(2, width = "30em")
```

# ESTIMAÇÃO 1

## MODELO

```{r modelo 1}

# anos selecionados
anos = 2020

# subset
rais = rais[rais$ano %in% anos, ]

# estimação
modelo_1 = lm(
    # variável dependente
    log(vlr_rem) ~
    # variáveis dependentes
    grau + sexo + raca_cor + idade + idade^2 +
    # interação
    sexo * raca_cor,
    # dataset
    data = rais
)

# adicionando resíduos ao dataframe
rais = within(rais, {
    residuos_1 = modelo_1$residuals
    fitted_1 = modelo_1$fitted.values
})
```

- Especificação inicial: log-linear

$$log(\mathbfit{Y}) = \mathbfit{X\beta} + \mathbfit{u}$$

- *Baseline variables*:

    - grau: nenhum
    - raca_cor: preta
    - sexo: feminino

## EQUAÇÃO DO MODELO

`r equatiomatic::extract_eq(modelo_1, wrap = TRUE, ital_vars = TRUE, terms_per_line = 2, intercept = "beta", font_size = "tiny")`

## DIAGNÓSTICO

- Heteroscedasticidade

```{r plot heteroscedasticidade modelo 1}
#| out.width: 80%

rais[sample(nrow(rais), 2000),] |> ggplot(aes(x = fitted_1, y = residuos_1)) + geom_point() + geom_smooth(method = "lm", se = FALSE)
```

## DIAGNÓSTICO

- Heteroscedasticidade

```{r teste bp modelo 1}
lmtest::bptest(modelo_1)
```

- Correção de White

## DIAGNÓSTICO

- Modelo bem especificado em relação à sua forma funcional
```{r teste reset modelo 1}
lmtest::resettest(modelo_1, type = "regressor")
```

## INTERPRETAÇÃO

```{r interpretacao modelo 1}
#| output: asis

# parâmetros
stargazer::stargazer(
    modelo_1,
    modelo_1,
    header = FALSE,
    single.row = TRUE,
    font.size = "tiny",
    column.labels = c("non-robust", "Robust"),
    omit.stat = c("n", "ser"),
    se = list(
        NULL,
        lmtest::coeftest(modelo_1, vcov. = sandwich::vcovHC)[, 2]
    )
)
```

## INTERPRETAÇÃO

- Variáveis contínuas:

$$ln(Y) = \beta_0 + \beta_1X_1$$

Derivando ambos lados em relação a $X_1$:

$$\frac{d\;ln(Y)}{d\;X_1} = 0 + \beta_1$$

Pela regra da cadeia:

$$
\begin{aligned}
\frac{1}{Y}Y' &= \beta_1\\
\frac{Y'}{Y} &= \beta_1
\end{aligned}
$$

Ou seja, $\beta_1$ é a variação relativa em $Y$ dada a variação unitária em $X$

## INTERPRETAÇÃO

- Variáveis binárias:

$$ln(Y) = \beta_0 + \beta_1X_1$$

Posso tomar a base $e$ que mantenho a coerência da equação:

$$
\begin{aligned}
e^{ln(Y)} &= e^{\beta_0 + \beta_1X_1} \\
Y &= e^{\beta_0}e^{\beta_1X_1}
\end{aligned}
$$

Então,

$$
Y = 
\begin{cases}
e^{\beta_0} & \text{se $X_1=0$} \\
e^{\beta_0}e^{\beta_1} & \text{se $X_1=1$}
\end{cases}
$$

O efeito de $X_1 = 1$ é relativo, com peso $e^{\beta_1}$

## INTERPRETAÇÃO

- Variável contínua: idade
    - a cada ano de idade, a renda aumenta 0,95% ($\beta$)

- Variáveis categóricas: escolaridade
    - completar ciclo fundamental: efeito de 17% na renda
    - médio (1.4) x fundamental (1.17): efeito 20% maior
    - superior (2.65) x médio: efeito 89% maior
    - mestrado (3.47) x superior: efeito 31% maior
    - doutorado (3.5) x mestrado: efeito 0,9% maior

## INTERPRETAÇÃO

- Variáveis categóricas: sexo/cor
    - mulher e branca: 5% na renda
    - homem: efeito de 31% na renda
    - homem e branco: efeito de 45% na renda
$$
e^{0.268+0.049+0.056}
$$

# ESTIMAÇÃO 2

## MODELAGEM COM OCUPAÇÃO E REGIÃO

```{r modelo 2}

# estimação
modelo_2 = lm(
    # variável dependente
    log(vlr_rem) ~
    # variáveis dependentes
    grau + sexo + raca_cor + idade + idade^2 +
    # interação
    sexo * raca_cor +
    # região
    regiao +
    # ocupação
    cbo,
    # dataset
    data = rais
)

# adicionando resíduos ao dataframe
rais = within(rais, {
    residuos_2 = modelo_2$residuals
    fitted_2 = modelo_2$fitted.values
})
```

- *Baseline variables*:

    - grau: nenhum
    - raca_cor: preta
    - sexo: feminino
    - região: interior
    - ocupação: 76
        - 7 (trabalhadores da produção de bens e serviços industriais)
        - 6 (trabalhadores da indústria têxtil, do curtimento, do vestuário e das artes gráficas)

## DIAGNÓSTICO

- Heteroscedasticidade

```{r plot heteroscedasticidade modelo 2}
#| out.width: 80%

rais[sample(nrow(rais), 2000),] |> ggplot(aes(x = fitted_2, y = residuos_2)) + geom_point() + geom_smooth(method = "lm", se = FALSE)
```

## DIAGNÓSTICO

- Heteroscedasticidade

```{r teste bp modelo 2}
lmtest::bptest(modelo_2)
```

- Correção de White

## DIAGNÓSTICO

- Modelo bem especificado em relação à sua forma funcional
```{r teste reset modelo 2}
lmtest::resettest(modelo_2, type = "regressor")
```

## INTERPRETAÇÃO

```{r interepretacao modelo 2}
#| output: asis

# parâmetros
stargazer::stargazer(
    modelo_2,
    modelo_2,
    header = FALSE,
    single.row = TRUE,
    font.size = "tiny",
    omit = "cbo",
    column.labels = c("non-robust", "Robust"),
    omit.stat = c("n", "ser"),
    se = list(
        NULL,
        lmtest::coeftest(modelo_2, vcov. = sandwich::vcovHC)[, 2]
    )
)
```

## INTERPRETAÇÃO

- Variável contínua: idade
    - a cada ano de idade, a renda aumenta 1% ($\beta$)

- Variáveis categóricas: escolaridade
    - completar ciclo fundamental: efeito de 8% na renda
    - médio (1.18) x fundamental (1.08): efeito 10% maior
    - superior (1.85) x médio: efeito 57% maior
    - mestrado (2.73) x superior: efeito 48% maior
    - doutorado (3.03) x mestrado: efeito 11% maior

## INTERPRETAÇÃO

- Variáveis categóricas: sexo/cor
    - mulher e branca: 3% na renda
    - homem: efeito de 19% na renda
    - homem e branco: efeito de 30% na renda

- Variáveis categóricas: região
    - grande vitória: 10% na renda

- Variáveis categóricas: ocupação
    - Profissionais das ciências exatas, físicas e da engenharia: efeito de 187% na renda
    - Trabalhadores de instalações e máquinas de celulose e papel: efeito de 178% na renda


# REFERÊNCIAS
